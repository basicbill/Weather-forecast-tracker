<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>15-Day Forecast Accuracy Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        
        h1 {
            color: #4c1d95;
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 48px;
            font-weight: bold;
            color: #4c1d95;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-sublabel {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 24px;
            color: #4c1d95;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .location-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .location-name {
            font-size: 20px;
            font-weight: bold;
            color: #4c1d95;
            margin-bottom: 15px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .metric {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .metric-name {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .metric-value.good {
            color: #10b981;
        }
        
        .metric-value.bad {
            color: #ef4444;
        }
        
        .recent-scores {
            margin-top: 20px;
        }
        
        .score-entry {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .score-date {
            font-size: 16px;
            font-weight: bold;
            color: #4c1d95;
        }
        
        .score-overall {
            font-size: 18px;
            font-weight: bold;
            padding: 5px 15px;
            border-radius: 20px;
            background: #10b981;
            color: white;
        }
        
        .score-overall.medium {
            background: #f59e0b;
        }
        
        .score-overall.low {
            background: #ef4444;
        }
        
        .score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            font-size: 14px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .icon {
            font-size: 16px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .no-data-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 28px;
            }
            
            .stat-value {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå§Ô∏è 15-Day Forecast Accuracy Tracker</h1>
            <p class="subtitle">Tracking long-range forecast accuracy over time</p>
        </div>
        
        <div id="content">
            <div class="loading">
                <p>Loading data...</p>
            </div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('data/results.json');
                
                if (!response.ok) {
                    if (response.status === 404) {
                        showNoData();
                        return;
                    }
                    throw new Error('Failed to load data');
                }
                
                const data = await response.json();
                
                if (!data.scores || data.scores.length === 0) {
                    showNoData();
                    return;
                }
                
                displayData(data);
            } catch (error) {
                console.error('Error loading data:', error);
                showError();
            }
        }
        
        function showNoData() {
            document.getElementById('content').innerHTML = `
                <div class="section">
                    <div class="no-data">
                        <div class="no-data-icon">üìä</div>
                        <h2>No Data Yet</h2>
                        <p style="margin-top: 10px;">The tracker is collecting data. Check back in 15 days for the first accuracy scores!</p>
                        <p style="margin-top: 10px; color: #999; font-size: 14px;">Daily forecasts are being saved automatically.</p>
                    </div>
                </div>
            `;
        }
        
        function showError() {
            document.getElementById('content').innerHTML = `
                <div class="section">
                    <div class="error">
                        <p>‚ö†Ô∏è Error loading data. Please try again later.</p>
                    </div>
                </div>
            `;
        }
        
        function displayData(data) {
            const scores = data.scores;
            
            // Calculate overall statistics
            const stats = calculateOverallStats(scores);
            const leadTimeStats = calculateLeadTimeStats(scores);
            
            // Build HTML
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Forecasts Scored</div>
                        <div class="stat-value">${stats.totalForecasts}</div>
                        <div class="stat-sublabel">Across all lead times</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Overall Accuracy</div>
                        <div class="stat-value">${stats.overallAccuracy}%</div>
                        <div class="stat-sublabel">All parameters combined</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Temperature Accuracy</div>
                        <div class="stat-value">${stats.tempAccuracy}%</div>
                        <div class="stat-sublabel">High & Low combined</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">Precipitation Accuracy</div>
                        <div class="stat-value">${stats.precipAccuracy}%</div>
                        <div class="stat-sublabel">Yes/No forecasts</div>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">üìâ Accuracy by Forecast Lead Time</div>
                    <div class="stats-grid">
                        ${generateLeadTimeCards(leadTimeStats)}
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: #f9fafb; border-radius: 8px; font-size: 14px; color: #666;">
                        <strong>Accuracy Degradation:</strong> Shows how forecast accuracy decreases as you look further into the future.
                        Tomorrow's forecast should be much more accurate than 15 days out.
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">üìç Accuracy by Location</div>
                    ${generateLocationStats(scores)}
                </div>
                
                <div class="section">
                    <div class="section-title">üìÖ Recent Forecasts</div>
                    <div class="recent-scores">
                        ${generateRecentScores(scores)}
                    </div>
                </div>
                
                <div class="section" style="text-align: center; color: #666; font-size: 14px;">
                    <p>Last updated: ${data.last_updated || 'Unknown'}</p>
                    <p style="margin-top: 10px;">Tracking 1-day, 3-day, 7-day, and 15-day forecasts ‚Ä¢ 10 locations across US climate zones</p>
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
        }
        
        function calculateLeadTimeStats(scores) {
            const leadTimes = [1, 3, 7, 15];
            const stats = {};
            
            leadTimes.forEach(lt => {
                stats[lt] = {
                    count: 0,
                    totalCorrect: 0,
                    totalMetrics: 0
                };
            });
            
            scores.forEach(score => {
                const lt = score.lead_time || 15; // Default to 15 for backwards compatibility
                
                if (!stats[lt]) return;
                
                Object.values(score.locations).forEach(location => {
                    stats[lt].count++;
                    
                    if (location.temp_high?.accurate) stats[lt].totalCorrect++;
                    if (location.temp_low?.accurate) stats[lt].totalCorrect++;
                    if (location.precipitation?.accurate) stats[lt].totalCorrect++;
                    if (location.condition?.accurate) stats[lt].totalCorrect++;
                    
                    stats[lt].totalMetrics += 4;
                });
            });
            
            // Calculate percentages
            Object.keys(stats).forEach(lt => {
                if (stats[lt].totalMetrics > 0) {
                    stats[lt].percentage = Math.round((stats[lt].totalCorrect / stats[lt].totalMetrics) * 100);
                } else {
                    stats[lt].percentage = 0;
                }
            });
            
            return stats;
        }
        
        function generateLeadTimeCards(leadTimeStats) {
            const leadTimes = [1, 3, 7, 15];
            
            return leadTimes.map(lt => {
                const stat = leadTimeStats[lt];
                const hasData = stat.count > 0;
                const percentage = hasData ? stat.percentage : 0;
                const colorClass = percentage >= 75 ? 'good' : percentage >= 50 ? '' : 'bad';
                
                return `
                    <div class="stat-card">
                        <div class="stat-label">${lt}-Day Forecast</div>
                        <div class="stat-value ${hasData ? colorClass : ''}">${hasData ? percentage + '%' : '‚Äî'}</div>
                        <div class="stat-sublabel">${hasData ? stat.count + ' forecasts' : 'No data yet'}</div>
                    </div>
                `;
            }).join('');
        }
        
        function calculateOverallStats(scores) {
            let totalForecasts = 0;
            let overallCorrect = 0;
            let tempHighCorrect = 0;
            let tempLowCorrect = 0;
            let precipCorrect = 0;
            let conditionCorrect = 0;
            let totalTemp = 0;
            let totalPrecip = 0;
            let totalCondition = 0;
            
            scores.forEach(score => {
                Object.values(score.locations).forEach(location => {
                    totalForecasts++;
                    
                    if (location.temp_high?.accurate) {
                        tempHighCorrect++;
                        overallCorrect++;
                    }
                    if (location.temp_low?.accurate) {
                        tempLowCorrect++;
                        overallCorrect++;
                    }
                    if (location.precipitation?.accurate) {
                        precipCorrect++;
                        overallCorrect++;
                    }
                    if (location.condition?.accurate) {
                        conditionCorrect++;
                        overallCorrect++;
                    }
                    
                    totalTemp += 2; // high and low
                    totalPrecip++;
                    totalCondition++;
                });
            });
            
            const totalMetrics = totalForecasts * 4; // 4 metrics per forecast
            
            return {
                overallAccuracy: totalMetrics > 0 ? Math.round((overallCorrect / totalMetrics) * 100) : 0,
                tempAccuracy: totalTemp > 0 ? Math.round(((tempHighCorrect + tempLowCorrect) / totalTemp) * 100) : 0,
                precipAccuracy: totalPrecip > 0 ? Math.round((precipCorrect / totalPrecip) * 100) : 0,
                conditionAccuracy: totalCondition > 0 ? Math.round((conditionCorrect / totalCondition) * 100) : 0,
                totalForecasts: totalForecasts
            };
        }
        
        function generateLocationStats(scores) {
            const locationStats = {};
            
            scores.forEach(score => {
                Object.entries(score.locations).forEach(([name, location]) => {
                    if (!locationStats[name]) {
                        locationStats[name] = {
                            total: 0,
                            tempHigh: 0,
                            tempLow: 0,
                            precip: 0,
                            condition: 0,
                            count: 0
                        };
                    }
                    
                    locationStats[name].count++;
                    if (location.temp_high?.accurate) locationStats[name].tempHigh++;
                    if (location.temp_low?.accurate) locationStats[name].tempLow++;
                    if (location.precipitation?.accurate) locationStats[name].precip++;
                    if (location.condition?.accurate) locationStats[name].condition++;
                    
                    const accurate = [
                        location.temp_high?.accurate,
                        location.temp_low?.accurate,
                        location.precipitation?.accurate,
                        location.condition?.accurate
                    ].filter(a => a).length;
                    
                    locationStats[name].total += accurate;
                });
            });
            
            return Object.entries(locationStats).map(([name, stats]) => {
                const percentage = Math.round((stats.total / (stats.count * 4)) * 100);
                const tempHighPct = Math.round((stats.tempHigh / stats.count) * 100);
                const tempLowPct = Math.round((stats.tempLow / stats.count) * 100);
                const precipPct = Math.round((stats.precip / stats.count) * 100);
                const conditionPct = Math.round((stats.condition / stats.count) * 100);
                
                return `
                    <div class="location-card">
                        <div class="location-name">üìç ${name}</div>
                        <div class="metrics-grid">
                            <div class="metric">
                                <div class="metric-name">Overall</div>
                                <div class="metric-value ${percentage >= 75 ? 'good' : percentage >= 50 ? '' : 'bad'}">${percentage}%</div>
                            </div>
                            <div class="metric">
                                <div class="metric-name">Temp High</div>
                                <div class="metric-value ${tempHighPct >= 75 ? 'good' : tempHighPct >= 50 ? '' : 'bad'}">${tempHighPct}%</div>
                            </div>
                            <div class="metric">
                                <div class="metric-name">Temp Low</div>
                                <div class="metric-value ${tempLowPct >= 75 ? 'good' : tempLowPct >= 50 ? '' : 'bad'}">${tempLowPct}%</div>
                            </div>
                            <div class="metric">
                                <div class="metric-name">Precipitation</div>
                                <div class="metric-value ${precipPct >= 75 ? 'good' : precipPct >= 50 ? '' : 'bad'}">${precipPct}%</div>
                            </div>
                            <div class="metric">
                                <div class="metric-name">Conditions</div>
                                <div class="metric-value ${conditionPct >= 75 ? 'good' : conditionPct >= 50 ? '' : 'bad'}">${conditionPct}%</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function generateRecentScores(scores) {
            // Sort by date (most recent first)
            const sorted = [...scores].sort((a, b) => 
                new Date(b.forecast_for) - new Date(a.forecast_for)
            );
            
            return sorted.slice(0, 20).map(score => {
                const date = new Date(score.forecast_for);
                const dateStr = date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                const leadTime = score.lead_time || 15; // Default to 15 for backwards compatibility
                const leadTimeLabel = leadTime === 1 ? '1-day' : `${leadTime}-day`;
                
                // Calculate overall percentage for this forecast
                let totalCorrect = 0;
                let totalMetrics = 0;
                
                const locationDetails = Object.entries(score.locations).map(([name, location]) => {
                    const pct = location.overall?.percentage || 0;
                    totalCorrect += location.overall?.accurate_count || 0;
                    totalMetrics += location.overall?.total_count || 0;
                    
                    return `
                        <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px;">
                            <strong>${name}:</strong> ${pct}%
                            <div class="score-details">
                                <div class="detail-item">
                                    <span class="icon">${location.temp_high?.accurate ? '‚úÖ' : '‚ùå'}</span>
                                    High: ${location.temp_high?.forecast}¬∞F ‚Üí ${location.temp_high?.actual}¬∞F
                                </div>
                                <div class="detail-item">
                                    <span class="icon">${location.temp_low?.accurate ? '‚úÖ' : '‚ùå'}</span>
                                    Low: ${location.temp_low?.forecast}¬∞F ‚Üí ${location.temp_low?.actual}¬∞F
                                </div>
                                <div class="detail-item">
                                    <span class="icon">${location.precipitation?.accurate ? '‚úÖ' : '‚ùå'}</span>
                                    Precip: ${location.precipitation?.forecast} ‚Üí ${location.precipitation?.actual}
                                </div>
                                <div class="detail-item">
                                    <span class="icon">${location.condition?.accurate ? '‚úÖ' : '‚ùå'}</span>
                                    Condition: ${location.condition?.forecast} ‚Üí ${location.condition?.actual}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                const overallPct = totalMetrics > 0 ? Math.round((totalCorrect / totalMetrics) * 100) : 0;
                const overallClass = overallPct >= 75 ? '' : overallPct >= 50 ? 'medium' : 'low';
                
                return `
                    <div class="score-entry">
                        <div class="score-header">
                            <div>
                                <div class="score-date">üìÖ ${dateStr}</div>
                                <div style="font-size: 13px; color: #666; margin-top: 3px;">
                                    ${leadTimeLabel} forecast
                                </div>
                            </div>
                            <div class="score-overall ${overallClass}">${overallPct}% Accurate</div>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                            Forecast made on ${new Date(score.date_made).toLocaleDateString('en-US')} ‚Ä¢ 
                            Scored on ${new Date(score.scored_on).toLocaleDateString('en-US')}
                        </div>
                        ${locationDetails}
                    </div>
                `;
            }).join('');
        }
        
        // Load data on page load
        loadData();
    </script>
</body>
</html>
